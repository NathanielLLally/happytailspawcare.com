<!--Div that will hold the dashboard-->
    <div id="dashboard_div">
      <!--Divs that will hold each control and chart-->
      <div id="toolbar_div"></div>
      <div id="filter_div"></div>
      <div id="filter2_div"></div>
      <div id="filter3_div"></div>
      <div id="chart_div" style="width:100%; height:100%;"></div>
      <div id="b1"></div>
    </div>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script>

  google.charts.load('current',{'packages':['corechart','controls', 'charteditor']});
  google.charts.setOnLoadCallback(chartStuff);

function chartStuff() {
  console.log("chartStuff begin")
  var dataSourceUrl = "https://script.google.com/macros/s/AKfycbwJXeC4vPpjUAZGqNQ-_qq8cKTB5g5tSSIyvfDzOchjxNv9V_Z4auBwC-adljfYQ2m6/exec?action=update";

  //  kludge here
  //
  var query = new google.visualization.Query(dataSourceUrl);
  console.log("CORS bypass workaround, this call should fail!")
  query.setTimeout(1);
  query.send(queryResponseWebAppScript);
}

//
function queryResponseWebAppScript(response) {
  console.log("queryResponseWebAppScript begin")

  var dataSourceUrl = 'https://docs.google.com/spreadsheets/d/1YYVl5EGOy2WOk74l3DmtaugP5RgW_c6UQDtJkTE4itE/gviz/tq?gid=433166320&headers=1&tq=';

  var query = new google.visualization.Query(dataSourceUrl);
  query.send(drawChart);
}

  //animation
 function init() {
    var options = {
      width: 400,
      height: 240,
      animation:{
        duration: 1000,
        easing: 'out',
      },
      vAxis: {minValue:0, maxValue:1000}
    };
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'N');
    data.addColumn('number', 'Value');
    data.addRow(['V', 200]);

    var chart = new google.visualization.ColumnChart(
        document.getElementById('visualization'));
    var button = document.getElementById('b1');

    function drawAChart() {
      // Disabling the button while the chart is drawing.
      button.disabled = true;
      google.visualization.events.addListener(chart, 'ready',
          function() { button.disabled = false; });
      chart.draw(data, options);
    }

    button.onclick = function() {
      var newValue = 1000 - data.getValue(0, 1);
      data.setValue(0, 1, newValue);
      drawAChart();
    }
    drawAChart();
  }

  //export / downloads
function drawToolbar() {
  var components = [
    {type: 'metadata', datasource: 'https://docs.google.com/spreadsheets/d/1YYVl5EGOy2WOk74l3DmtaugP5RgW_c6UQDtJkTE4itE/edit?gid=454960513#gid=454960513'},
      {type: 'sheetdata', datasource: 'https://spreadsheets.google.com/tq?key=pCQbetd-CptHnwJEfo8tALA'},
      {type: 'csv', datasource: 'https://spreadsheets.google.com/tq?key=pCQbetd-CptHnwJEfo8tALA'},

  ];

  var container = document.getElementById('toolbar_div');
  google.visualization.drawToolbar(container, components);
};

function drawChart(response) {
       console.log("drawChart begin")
       var data = response.getDataTable();


      var view = new google.visualization.DataView(data);

      var chart = new google.visualization.ChartWrapper({
        'chartType': 'ComboChart',
        'containerId': 'chart_div',
        'options': {
          title: 'Business Growth Model (Retention-Driven)',
          crosshair: { trigger: 'both' },
          height: 750,
          legend: {
               position: 'bottom',
            orientation: 'vertical',
            textStyle: {
              color: '#ff0000',
              fontSize: 14
            }
          },
          focusTarget: 'category',
          tooltip: { isHtml: true },
          
          seriesType: 'bars',

          series: {
            0: { type: 'bars', targetAxisIndex: 0 }, // New Clients
            1: { type: 'line', targetAxisIndex: 0 }, // Active Clients
            2: { type: 'bars', targetAxisIndex: 0 }, // Churned Clients
            3: { type: 'line', targetAxisIndex: 1 }, // Revenue
            4: { type: 'line', targetAxisIndex: 1 }  // Ad_Spend
          },

          vAxes: {
            0: {
              title: 'Clients',
format:'short'
            },
            1: {
              title: 'Revenue / Ad Spend',
              format: 'short'
            }
          },
        }
        });
 
        // Create a dashboard.
        var dashboard = new google.visualization.Dashboard(
            document.getElementById('dashboard_div'));
        
  drawToolbar();

//slider range func            programmaticSlider.setState({'lowValue': 2, 'highValue': 5}); 
  // save reference to dashboard
       console.log("constructor dashboard.bind")
  var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'))

       console.log("draw")
  dashboard.draw(view);

//        dashboard.bind(rangeSlider, chart);
       console.log("drawChart exit")
    }
</script>
